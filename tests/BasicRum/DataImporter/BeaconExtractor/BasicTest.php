<?php

namespace App\Tests\BasicRum\DataImporter\BeaconExtractor;

use PHPUnit\Framework\TestCase;

use \App\BasicRum\DataImporter\BeaconsExtractor;
use \App\BasicRum\DataImporter\Process;
use App\BasicRum\Metrics\ImportCollaborator;

class BasicTest extends TestCase
{
    /**
     * @group data_batcher
     */
    public function testCommon()
    {
        $importCollaborator = new ImportCollaborator();

        $beacons = [
            json_decode(
                '{"mob_etype":"4g","mob_dl":"10","mob_rtt":"50","c_e":"kawjwmel","c_tti_m":"lt","rt_start":"navigation","rt_bmr":"518,19,4,1","rt_tstart":"1591019457645","rt_bstart":"1591019458215","rt_blstart":"1591019458163","rt_end":"1591019459302","t_resp":"368","t_page":"1289","t_done":"1657","t_other":"t_domloaded|1137,boomerang|14,boomr_fb|570,boomr_ld|518,boomr_lat|52","rt_tt":"4850","rt_obo":"0","pt_fp":"693","pt_fcp":"860","nt_nav_st":"1591019457645","nt_fet_st":"1591019457646","nt_dns_st":"1591019457646","nt_dns_end":"1591019457646","nt_con_st":"1591019457646","nt_con_end":"1591019457646","nt_req_st":"1591019457649","nt_res_st":"1591019458012","nt_res_end":"1591019458022","nt_domloading":"1591019458023","nt_domint":"1591019458700","nt_domcontloaded_st":"1591019458700","nt_domcontloaded_end":"1591019458781","nt_domcomp":"1591019459269","nt_load_st":"1591019459269","nt_load_end":"1591019459302","nt_unload_st":"1591019458018","nt_unload_end":"1591019458018","nt_ssl_st":"1591019457646","nt_enc_size":"78155","nt_dec_size":"278284","nt_trn_size":"78739","nt_protocol":"h2","nt_first_paint":"1591019458338","nt_red_cnt":"0","nt_nav_type":"1","restiming":"{\"https:\/\/\":{\"r\":{\"oastmarket.local\/\":{\"|\":\"6,ai,a8,4,1,1,1,1,1*11oaz,g8,4af5\",\"skin\/frontend\/\":{\"r\":{\"wd\/default\/\":{\"integernet\/solr\/css\/\":{\"filter.css\":\"2aw,k,e,e*1wo,4q,1zg*44\",\"loader.css\":\"2aw,k,e,e*1op,4q,1tc*44\"},\"css\/me\/lff\/lff.css\":\"2aw,l,f,e*1ox,4t*44\"},\"oastmarket\/default\/\":{\"css\/\":{\"h\":{\"eader.css\":\"2b0,11,p,j*13w7,4r,e2f*44\",\"ome.css\":\"2b1,10,p,j*1880,50,ub9*44\"},\"promo-banner.css\":\"2ay,z,l,k*1cx,4q,g8*44\",\"fo\":{\"nts.css\":\"2b0,y,j,i*19g,4q,1ed*44\",\"oter.css\":\"2b1,10,p,j*119y,4r,3tf*44\"},\"lib\/\":{\"featherlight.min.css\":\"2b0,y,k,i*1m2,4q,tu*44\",\"loader.css\":\"2b0,y,k,i*1iz,4r,25p*44\",\"swiper.min.css\":\"2b1,10,p,j*13ij,4r,71e*44\"}},\"images\/\":{\"app-icon-512.png\":\"1b2,6z,6w,6v*16z5,54\",\"roastmarket.svg\":\"*0i,4g,m,20,y,8c|1eh,3k,3h,3g*13mo,4z\"},\"js\/lib\/require.min.js\":\"3fb,11,10,z*15nh,51,803*24\",\"fonts\/roboto-v20-latin-ext_latin-\":{\"700.woff2\":\"4kv,5,2,2*1hj8,5n\",\"900.woff2\":\"4kv,4,2,1*1hg0,5n\",\"regular.woff2\":\"4hj,3,2,1*1hh0,5n\"}}},\"base\/default\/css\/\":{\"plugincompany\/lazyload.css\":\"2ay,y,l,j*18o,4t*44\",\"theextensionlab\/megamenu\/\":{\"grid.css\":\"2az,y,k,j*1cn,4r,1ae*44\",\"main.css\":\"2az,y,k,j*1zg,4r,2g4*44\",\"responsive.css\":\"2b0,x,j,i*1ob,4r,2ul*44\"},\"mirasvit\/searchautocomplete\/rwd.css\":\"2b0,z,k,i*11oh,4r,5vg*44\"}},\"media\/\":{\"js\/\":{\"3ac9bce354303b95853d2c1f589c97c2-1572370329.js\":\"3b1,15,13,s*13f3,51,7pc*20\",\"a95e81de13b7614a146bebf359327637-1590957095.js\":\"3b1,15,p,j*11v81,82,3jg7*20\",\"fc863bfabc6aeb64665854e2dcac765f-1590958285.js\":\"3b2,1d,17,14*11py1,7k,3s8i*20\"},\"wysiwyg\/\":{\"mobile\/mobile-menu-image.jpg\":\"1ei,5z,3k,3j*1fo\",\"home\/\":{\"banner\/\":{\"solino-mobile3.jpg\":\"1ep,5s,3e,3c*1fo\",\"app-download-mobil_x2.jpg\":\"4qa,5t,2,2*1fo\"},\"top-categories\/kaffee.jpg\":\"1ep,5t,3e,3d*1fo\"}},\"catalog\/\":{\"category\/\":{\"g\":{\"anzebohnen_x2.jpg\":\"*05h,an,hj,f,8y,hd|1ya,7,3,2*11en9,6y\",\"emahlenerkaffee_x2.jpg\":\"*05h,an,1d8,f,8y,hd|1118,8,4,3*11fd9,6y\"},\"vollautomat_x2.jpg\":\"*05h,an,pg,f,8y,hd|1ya,7,3,2*1y7g,66\",\"siebtraeger_x2.jpg\":\"*05h,an,xe,f,8y,hd|1ya,8,5,2*12b3h,88\",\"filterkaffee_x2.jpg\":\"*05h,an,15b,f,8y,hd|1118,7,4,3*11j46,6y\",\"kaffeekapseln_x2.jpg\":\"*05h,an,1l6,f,8y,hd|111x,3,2,1*1285t,7z\"},\"product\/cache\/1\/small_image\/235x353\/9df78eab33525d08d6e5fb8d27136e95\/\":{\"g\/o\/gorilla-super-bar-crema-1kg-front.jpg\":\"*06s,4j,1zf,k,9t,6j|113r,4,2,1*1coo,5f\",\"t\/r\/tre-forze-espresso-caffe-250g-front.jpg\":\"*06s,4j,1zf,5s,9t,6j|113r,5,3,2*1699,4w\"}}},\"recommend\/bestsellers\/home\/\":\"5mw,g1,fx,2*1j1,ep,276\",\"js\/build\/1587371220\/home.js\":\"3y4,3,2,1*12g4,51,3oi*21\"},\"ecommender.scarabresearch.com\/merchants\/126AD1C461B22A0C\/?pv=2141259831&xp=1&cv=1&ca=&cp=1&currency=eur&vi=EA521F3150D1B1D&ti=2%2C1299%2C1118%2C1072%2C%2C%7Cl%2C%2C1001%2C1003%2C1015%2C1047%2C1064%2C1086%2C1092%2C%2C%7Cd%2C%2C1302%2C1305%2C1316%2C1337%2C1391%2C1410%2C1413%2C1460%2C1301\":\"5111,45,3t,33,33,1w,o,o,3*12g,dy\"},\"w\":{\"ww.\":{\"google\":{\".\":{\"com\/pagead\/1p-user-list\/913819751\/?...\":\"111f,2y,2w,6,4,4,4,4,4*116,i1\",\"de\/pagead\/1p-user-list\/913819751\/?...\":\"111f,3g,3a,6,5,5,5,5,5*116,ee\"},\"-analytics.com\/\":{\"analytics.js\":\"3ed,46*21\",\"gtm\/js?id=GTM-MRVF3QH&cid=1579213649.1590958054\":\"3o4,1h*21\"},\"adservices.com\/pagead\/conversion.js\":\"3fb,2x,2w,1l,2d,1j,1j,1j,z*18bw,oo,dl1*24\"},\"roastmarket.de\/media\/wysiwyg\/logos\/\":{\"ssl.png\":\"*01m,1m,6bh,f,3d,3d|1fb,3n\",\"trustedshop.png\":\"*01m,1m,6bh,26,3d,3d|1fb,3o\"}},\"idgets.trustedshops.com\/js\/XE419FA5E3F0540448CB749813C823894.js\":\"3125,p*21\"},\"cdn.scarabresearch.com\/js\/126AD1C461B22A0C\/scarab-v2.js\":\"3rc,l,f,2*1ieo,ek,1p3w*21\",\"googleads.g.doubleclick.net\/pagead\/viewthroughconversion\/913819751\/?...\":\"3rr,2x,2w,7,16,4,4,4,4*1w6,pc,118*21\",\"static.scarabresearch.com\/wpjs\/wp\":{\"loader.js?ts=2630\":\"3112,13*21\",\"es6.js?ts=2630\":\"3149,n*21\"}}}","u":"https:\/\/roastmarket.local\/","v":"1.0.0","sv":"14","sm":"p","rt_si":"0b34988e-87b8-4b64-be0e-fe088caa9dff-qb92e1","rt_ss":"1591019353153","rt_sl":"3","vis_st":"visible","ua_plt":"Linux x86_64","ua_vnd":"Google Inc.","pid":"icze9ogi","n":"1","c_l":"31cp|31dt","c_t_longtask":"00102001*4*01","c_t_fps":"013*5*1241242","c_t_inter":"0*b*011","c_t_key":"0*b*011","c_tti_vr":"1137","c_lt_n":"5","c_lt_tt":"373.5300000407733","c_lt":"~(~(a~(~(a~0~s~\'~t~0))~d~\'1z~n~1~s~\'g9)~(a~(~(a~0~s~\'~t~0))~d~\'1u~n~1~s~\'l6)~(a~(~(a~0~s~\'~t~0))~d~\'1w~n~1~s~\'o5)~(a~(~(a~0~s~\'~t~0))~d~\'2p~n~1~s~\'t6)~(a~(~(a~0~s~\'~t~0))~d~\'22~n~1~s~\'195))","c_f":"19","c_f_d":"1229","c_f_m":"1","c_f_l":"10","c_f_s":"kawjwmuj","c_k":"2","c_ttfi":"1753","c_i_a":"1","c_fid":"1","dom_res":"57","dom_doms":"12","mem_total":"20952547","mem_limit":"2172649472","mem_used":"20087059","mem_lsln":"4","mem_ssln":"2","mem_lssz":"263","mem_sssz":"5817","scr_xy":"1920x1080","scr_bpp":"24\/24","scr_orn":"0\/landscape-primary","cpu_cnc":"8","dom_ln":"1842","dom_sz":"288903","dom_ck":"263","dom_img":"25","dom_img_ext":"18","dom_img_uniq":"14","dom_script":"40","dom_script_ext":"14","dom_iframe":"0","dom_link":"31","dom_link_css":"17","sb":"1","user_agent":"Mozilla\/5.0 (X11; Linux x86_64) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/83.0.4103.61 Safari\/537.36","created_at":"2020-06-01 13:50:59"}',
                true
            ),
            json_decode(
                '{"mob_etype":"4g","mob_dl":"10","mob_rtt":"50","rt_start":"navigation","rt_bmr":"1444,5,4,2","rt_tstart":"1591566864796","rt_bstart":"1591566866267","rt_blstart":"1591566866240","rt_end":"1591566866944","t_resp":"1327","t_page":"821","t_done":"2148","t_other":"t_domloaded|1810,boomerang|14,boomr_fb|1471,boomr_ld|1444,boomr_lat|27","rt_tt":"2148","rt_obo":"0","pt_fp":"1587","pt_fcp":"1687","nt_nav_st":"1591566864796","nt_fet_st":"1591566864798","nt_dns_st":"1591566864807","nt_dns_end":"1591566864807","nt_con_st":"1591566864807","nt_con_end":"1591566864809","nt_req_st":"1591566864809","nt_res_st":"1591566866123","nt_res_end":"1591566866142","nt_domloading":"1591566866128","nt_domint":"1591566866573","nt_domcontloaded_st":"1591566866573","nt_domcontloaded_end":"1591566866606","nt_domcomp":"1591566866924","nt_load_st":"1591566866924","nt_load_end":"1591566866944","nt_ssl_st":"1591566864807","nt_enc_size":"76519","nt_dec_size":"273411","nt_trn_size":"77096","nt_protocol":"h2","nt_first_paint":"1591566866383","nt_red_cnt":"0","nt_nav_type":"1","restiming":"{\"https:\/\/\":{\"r\":{\"oastmarket.local\/\":{\"|\":\"6,11e,10v,e,d,c,c,c,c*11n1j,g1,47x8\",\"skin\/frontend\/\":{\"r\":{\"wd\/default\/\":{\"integernet\/solr\/css\/\":{\"filter.css\":\"211g,i,c,c*1wo,4q,1zg*44\",\"loader.css\":\"211h,i,f,d*1op,4q,1tc*44\"},\"css\/me\/lff\/lff.css\":\"211h,j,f,e*1ox,4t*44\"},\"oastmarket\/default\/\":{\"css\/\":{\"h\":{\"eader.css\":\"211i,s,n,k*13w7,4r,e2f*44\",\"ome.css\":\"211j,r,n,j*1880,50,ub9*44\"},\"promo-banner.css\":\"211h,j,h,g*1cx,4q,g8*44\",\"fo\":{\"nts.css\":\"211i,r,l,k*19g,4q,1ed*44\",\"oter.css\":\"211i,s,o,k*119y,4r,3tf*44\"},\"lib\/\":{\"featherlight.min.css\":\"211i,r,m,k*1m2,4q,tu*44\",\"loader.css\":\"211i,r,m,k*1iz,4r,25p*44\",\"swiper.min.css\":\"211j,r,n,j*13ij,4r,71e*44\"}},\"images\/\":{\"app-icon-512.png\":\"111j,52,50,4z*16z5,54\",\"roastmarket.svg\":\"*0m,5k,1k,b8,y,8c|111k,51,4z,4y*13mo,4z\"},\"js\/lib\/require.min.js\":\"314s,m,l,j*15nh,51,803*24\",\"fonts\/roboto-v20-latin-ext_latin-\":{\"700.woff2\":\"418q,1i,1g,1f*1hj8,5n\",\"900.woff2\":\"418p,1j,1g,1f*1hg0,5n\",\"regular.woff2\":\"4162,y,x,x*1hh0,5n\"}}},\"base\/default\/css\/\":{\"plugincompany\/lazyload.css\":\"211h,j,h,e*18o,4t*44\",\"theextensionlab\/megamenu\/\":{\"grid.css\":\"211h,l,j,h*1cn,4r,1ae*44\",\"main.css\":\"211h,m,k,j*1zg,4r,2g4*44\",\"responsive.css\":\"211h,r,m,k*1ob,4r,2ul*44\"},\"mirasvit\/searchautocomplete\/rwd.css\":\"211i,s,m,k*11oh,4r,5vg*44\"}},\"media\/\":{\"js\/\":{\"3ac9bce354303b95853d2c1f589c97c2-1572370329.js\":\"311j,u,t,j*13f3,51,7pc*20\",\"a95e81de13b7614a146bebf359327637-1590957095.js\":\"311j,u,p,j*11v81,82,3jg7*20\",\"fc863bfabc6aeb64665854e2dcac765f-1590958285.js\":\"311j,z,w,j*11py1,7k,3s8i*20\"},\"wysiwyg\/home\/\":{\"0719\/banner-magazin-v3_x2.jpg\":\"41az,6,3,3*130q3,98\",\"banner\/solino\":{\"-mobile3.jpg\":\"114d,2l,26,25*1fo\",\"_d1.jpg\":\"418m,1e,2,1*1fo\"},\"top-categories\/kaffee.jpg\":\"114e,2k,25,24*1fo\",\"app-banner_x2.jpg\":\"41b0,3j,4,2*1fo\"},\"catalog\/category\/\":{\"g\":{\"anzebohnen_x2.jpg\":\"*04n,90,rf,b8,8y,hd|11fp,d,8,6*11en9,6y\",\"emahlenerkaffee_x2.jpg\":\"*04n,90,rf,1dg,8y,hd|11fp,g,b,7*11fd9,6y\"},\"vollautomat_x2.jpg\":\"*04n,90,rf,ks,8y,hd|11fp,e,8,6*1y7g,66\",\"siebtraeger_x2.jpg\":\"*04n,90,rf,uc,8y,hd|11fp,f,a,6*12b3h,88\",\"filterkaffee_x2.jpg\":\"*04n,90,rf,13w,8y,hd|11fp,g,b,6*11j46,6y\"}},\"js\/build\/1587371220\/home.js\":\"31fl,7,3,2*12g4,51,3oi*21\"},\"ecommender.scarabresearch.com\/merchants\/126AD1C461B22A0C\/?pv=2065275091&xp=1&cv=1&ca=&cp=1&currency=eur&vi=EA521F3150D1B1D\":\"51i1,2x,2w,2e,2e,14,g,g,2*12g,dy\"},\"w\":{\"ww.\":{\"google\":{\".\":{\"com\/pagead\/1p-user-list\/913819751\/?...\":\"11kq,2b,2a,2*116,9v\",\"de\/pagead\/1p-user-list\/913819751\/?...\":\"11kr,1i,1h,2,1,1,1,1,1*116,ee\"},\"-analytics.com\/\":{\"analytics.js\":\"3143,7t*21\",\"gtm\/js?id=GTM-MRVF3QH&cid=1579213649.1590958054\":\"31ga,1i*21\"},\"adservices.com\/pagead\/conversion.js\":\"314r,1x,1v,m,1e,l,k,k,k*18c5,-7pk,dl7*24\"},\"roastmarket.de\/media\/wysiwyg\/logos\/\":{\"ssl.png\":\"*01m,1m,3yz,wp,3d,3d|114r,1v\",\"trustedshop.png\":\"*01m,1m,3yz,yg,3d,3d|114r,1w\"}},\"idgets.trustedshops.com\/js\/XE419FA5E3F0540448CB749813C823894.js\":\"31i7,20*21\"},\"cdn.scarabresearch.com\/js\/126AD1C461B22A0C\/scarab-v2.js\":\"31bv,2q,2o,2a,2a,1b,h,h,3*1ieo,-i2s,1p3w*21\",\"googleads.g.doubleclick.net\/pagead\/viewthroughconversion\/913819751\/?...\":\"31c9,7j,7i,4,1x,2,1,1,1*1w8,pc,116*21\",\"static.scarabresearch.com\/wpjs\/wp\":{\"loader.js?ts=2631\":\"31i3,7*21\",\"es6.js?ts=2631\":\"31iz,3*21\"}}}","u":"https:\/\/roastmarket.local\/","v":"1.0.0","sv":"14","sm":"p","rt_si":"0b34988e-87b8-4b64-be0e-fe088caa9dff-qbksup","rt_ss":"1591566864796","rt_sl":"1","vis_st":"visible","ua_plt":"Linux x86_64","ua_vnd":"Google Inc.","pid":"2kjvy9rb","n":"1","dom_res":"56","dom_doms":"12","mem_total":"5829535","mem_limit":"2172649472","mem_used":"4864619","mem_lsln":"4","mem_ssln":"2","mem_lssz":"269","mem_sssz":"1952","scr_xy":"1920x1080","scr_bpp":"24\/24","scr_orn":"0\/landscape-primary","cpu_cnc":"8","dom_ln":"1850","dom_sz":"285781","dom_ck":"260","dom_img":"25","dom_img_ext":"17","dom_img_uniq":"13","dom_script":"40","dom_script_ext":"14","dom_iframe":"0","dom_link":"31","dom_link_css":"17","sb":"1","user_agent":"Mozilla\/5.0 (X11; Linux x86_64) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/83.0.4103.61 Safari\/537.36","created_at":"2020-06-07 21:54:27"}',
                true
            ),
            json_decode(
                '{"mob_etype":"4g","mob_dl":"10","mob_rtt":"50","rt_start":"navigation","rt_bmr":"1444,5,4,2","rt_tstart":"1591566864796","rt_bstart":"1591566866267","rt_blstart":"1591566866240","rt_end":"1591566866944","t_resp":"1327","t_page":"821","t_done":"2148","t_other":"t_domloaded|1810,boomerang|14,boomr_fb|1471,boomr_ld|1444,boomr_lat|27","rt_tt":"2148","rt_obo":"0","pt_fp":"1587","pt_fcp":"1687","nt_nav_st":"1591566864796","nt_fet_st":"1591566864798","nt_dns_st":"1591566864807","nt_dns_end":"1591566864807","nt_con_st":"1591566864807","nt_con_end":"1591566864809","nt_req_st":"1591566864809","nt_res_st":"1591566866123","nt_res_end":"1591566866142","nt_domloading":"1591566866128","nt_domint":"1591566866573","nt_domcontloaded_st":"1591566866573","nt_domcontloaded_end":"1591566866606","nt_domcomp":"1591566866924","nt_load_st":"1591566866924","nt_load_end":"1591566866944","nt_ssl_st":"1591566864807","nt_enc_size":"76519","nt_dec_size":"273411","nt_trn_size":"77096","nt_protocol":"h2","nt_first_paint":"1591566866383","nt_red_cnt":"0","nt_nav_type":"1","restiming":"{\"https:\/\/\":{\"r\":{\"oastmarket.local\/\":{\"|\":\"6,11e,10v,e,d,c,c,c,c*11n1j,g1,47x8\",\"skin\/frontend\/\":{\"r\":{\"wd\/default\/\":{\"integernet\/solr\/css\/\":{\"filter.css\":\"211g,i,c,c*1wo,4q,1zg*44\",\"loader.css\":\"211h,i,f,d*1op,4q,1tc*44\"},\"css\/me\/lff\/lff.css\":\"211h,j,f,e*1ox,4t*44\"},\"oastmarket\/default\/\":{\"css\/\":{\"h\":{\"eader.css\":\"211i,s,n,k*13w7,4r,e2f*44\",\"ome.css\":\"211j,r,n,j*1880,50,ub9*44\"},\"promo-banner.css\":\"211h,j,h,g*1cx,4q,g8*44\",\"fo\":{\"nts.css\":\"211i,r,l,k*19g,4q,1ed*44\",\"oter.css\":\"211i,s,o,k*119y,4r,3tf*44\"},\"lib\/\":{\"featherlight.min.css\":\"211i,r,m,k*1m2,4q,tu*44\",\"loader.css\":\"211i,r,m,k*1iz,4r,25p*44\",\"swiper.min.css\":\"211j,r,n,j*13ij,4r,71e*44\"}},\"images\/\":{\"app-icon-512.png\":\"111j,52,50,4z*16z5,54\",\"roastmarket.svg\":\"*0m,5k,1k,b8,y,8c|111k,51,4z,4y*13mo,4z\"},\"js\/lib\/require.min.js\":\"314s,m,l,j*15nh,51,803*24\",\"fonts\/roboto-v20-latin-ext_latin-\":{\"700.woff2\":\"418q,1i,1g,1f*1hj8,5n\",\"900.woff2\":\"418p,1j,1g,1f*1hg0,5n\",\"regular.woff2\":\"4162,y,x,x*1hh0,5n\"}}},\"base\/default\/css\/\":{\"plugincompany\/lazyload.css\":\"211h,j,h,e*18o,4t*44\",\"theextensionlab\/megamenu\/\":{\"grid.css\":\"211h,l,j,h*1cn,4r,1ae*44\",\"main.css\":\"211h,m,k,j*1zg,4r,2g4*44\",\"responsive.css\":\"211h,r,m,k*1ob,4r,2ul*44\"},\"mirasvit\/searchautocomplete\/rwd.css\":\"211i,s,m,k*11oh,4r,5vg*44\"}},\"media\/\":{\"js\/\":{\"3ac9bce354303b95853d2c1f589c97c2-1572370329.js\":\"311j,u,t,j*13f3,51,7pc*20\",\"a95e81de13b7614a146bebf359327637-1590957095.js\":\"311j,u,p,j*11v81,82,3jg7*20\",\"fc863bfabc6aeb64665854e2dcac765f-1590958285.js\":\"311j,z,w,j*11py1,7k,3s8i*20\"},\"wysiwyg\/home\/\":{\"0719\/banner-magazin-v3_x2.jpg\":\"41az,6,3,3*130q3,98\",\"banner\/solino\":{\"-mobile3.jpg\":\"114d,2l,26,25*1fo\",\"_d1.jpg\":\"418m,1e,2,1*1fo\"},\"top-categories\/kaffee.jpg\":\"114e,2k,25,24*1fo\",\"app-banner_x2.jpg\":\"41b0,3j,4,2*1fo\"},\"catalog\/category\/\":{\"g\":{\"anzebohnen_x2.jpg\":\"*04n,90,rf,b8,8y,hd|11fp,d,8,6*11en9,6y\",\"emahlenerkaffee_x2.jpg\":\"*04n,90,rf,1dg,8y,hd|11fp,g,b,7*11fd9,6y\"},\"vollautomat_x2.jpg\":\"*04n,90,rf,ks,8y,hd|11fp,e,8,6*1y7g,66\",\"siebtraeger_x2.jpg\":\"*04n,90,rf,uc,8y,hd|11fp,f,a,6*12b3h,88\",\"filterkaffee_x2.jpg\":\"*04n,90,rf,13w,8y,hd|11fp,g,b,6*11j46,6y\"}},\"js\/build\/1587371220\/home.js\":\"31fl,7,3,2*12g4,51,3oi*21\"},\"ecommender.scarabresearch.com\/merchants\/126AD1C461B22A0C\/?pv=2065275091&xp=1&cv=1&ca=&cp=1&currency=eur&vi=EA521F3150D1B1D\":\"51i1,2x,2w,2e,2e,14,g,g,2*12g,dy\"},\"w\":{\"ww.\":{\"google\":{\".\":{\"com\/pagead\/1p-user-list\/913819751\/?...\":\"11kq,2b,2a,2*116,9v\",\"de\/pagead\/1p-user-list\/913819751\/?...\":\"11kr,1i,1h,2,1,1,1,1,1*116,ee\"},\"-analytics.com\/\":{\"analytics.js\":\"3143,7t*21\",\"gtm\/js?id=GTM-MRVF3QH&cid=1579213649.1590958054\":\"31ga,1i*21\"},\"adservices.com\/pagead\/conversion.js\":\"314r,1x,1v,m,1e,l,k,k,k*18c5,-7pk,dl7*24\"},\"roastmarket.de\/media\/wysiwyg\/logos\/\":{\"ssl.png\":\"*01m,1m,3yz,wp,3d,3d|114r,1v\",\"trustedshop.png\":\"*01m,1m,3yz,yg,3d,3d|114r,1w\"}},\"idgets.trustedshops.com\/js\/XE419FA5E3F0540448CB749813C823894.js\":\"31i7,20*21\"},\"cdn.scarabresearch.com\/js\/126AD1C461B22A0C\/scarab-v2.js\":\"31bv,2q,2o,2a,2a,1b,h,h,3*1ieo,-i2s,1p3w*21\",\"googleads.g.doubleclick.net\/pagead\/viewthroughconversion\/913819751\/?...\":\"31c9,7j,7i,4,1x,2,1,1,1*1w8,pc,116*21\",\"static.scarabresearch.com\/wpjs\/wp\":{\"loader.js?ts=2631\":\"31i3,7*21\",\"es6.js?ts=2631\":\"31iz,3*21\"}}}","u":"https:\/\/roastmarket.local\/","v":"1.0.0","sv":"14","sm":"p","rt_si":"0b34988e-87b8-4b64-be0e-fe088caa9dff-qbksup","rt_ss":"1591566864796","rt_sl":"1","vis_st":"visible","ua_plt":"Linux x86_64","ua_vnd":"Google Inc.","pid":"2kjvy9rb","n":"1","dom_res":"56","dom_doms":"12","mem_total":"5829535","mem_limit":"2172649472","mem_used":"4864619","mem_lsln":"4","mem_ssln":"2","mem_lssz":"269","mem_sssz":"1952","scr_xy":"1920x1080","scr_bpp":"24\/24","scr_orn":"0\/landscape-primary","cpu_cnc":"8","dom_ln":"1850","dom_sz":"285781","dom_ck":"260","dom_img":"25","dom_img_ext":"17","dom_img_uniq":"13","dom_script":"40","dom_script_ext":"14","dom_iframe":"0","dom_link":"31","dom_link_css":"17","sb":"1","user_agent":"Mozilla\/5.0 (Series40; Nokia501\/10.0.2; Profile\/MIDP-2.1 Configuration\/CLDC-1.1) Gecko\/20100401 S40OviBrowser\/3.0.0.0.73","created_at":"2020-06-07 21:54:27"}',
                true
            )
        ];

        $beaconExtractor = new BeaconsExtractor(
            $importCollaborator->getBeaconExtractors(),
            $importCollaborator->getDerivedExtractors()
        );

        $extracted = $beaconExtractor->extract($beacons);

        $pr = new Process();
        $pr->runImport($extracted);

        $this->assertEquals(
            [
                [
                    "simple_tm_connect_duration" => 0,
                    "simple_tm_first_contentful_paint" => 860,
                    "simple_tm_first_paint" => 693,
                    "simple_tm_load_event_end" => 1657,
                    "simple_tm_redirects_count" => 0,
                    "simple_tm_time_to_first_byte" => 367,
                    "simple_tm_dns_duration" => 0,
                    "simple_tm_redirect_duration" => 0,
                    "simple_tm_download_time" => 373,
                    "simple_bm_session_id" => "0b34988e-87b8-4b64-be0e-fe088caa9dff-qb92e1",
                    "simple_bm_user_agent" => "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.61 Safari/537.36",
                    "derived_bm_browser_name" => "Chrome",
                    "derived_bm_browser_version" => "83.0.4103.61",
                    "derived_bm_device_type" => "desktop",
                    "derived_bm_device_manufacturer" => "",
                    "simple_bm_created_at" => "2020-06-01 13:50:59"
                ],
                [
                    "simple_tm_connect_duration" => 0,
                    "simple_tm_first_contentful_paint" => 1687,
                    "simple_tm_first_paint" => 1587,
                    "simple_tm_load_event_end" => 2148,
                    "simple_tm_redirects_count" => 0,
                    "simple_tm_time_to_first_byte" => 1327,
                    "simple_tm_dns_duration" => 0,
                    "simple_tm_redirect_duration" => 0,
                    "simple_tm_download_time" => 1333,
                    "simple_bm_session_id" => "0b34988e-87b8-4b64-be0e-fe088caa9dff-qbksup",
                    "simple_bm_user_agent" => "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.61 Safari/537.36",
                    "derived_bm_browser_name" => "Chrome",
                    "derived_bm_browser_version" => "83.0.4103.61",
                    "derived_bm_device_type" => "desktop",
                    "derived_bm_device_manufacturer" => "",
                    "simple_bm_created_at" => "2020-06-07 21:54:27"
                ],
                [
                    "simple_tm_connect_duration" => 0,
                    "simple_tm_first_contentful_paint" => 1687,
                    "simple_tm_first_paint" => 1587,
                    "simple_tm_load_event_end" => 2148,
                    "simple_tm_redirects_count" => 0,
                    "simple_tm_time_to_first_byte" => 1327,
                    "simple_tm_dns_duration" => 0,
                    "simple_tm_redirect_duration" => 0,
                    "simple_tm_download_time" => 1333,
                    "simple_bm_session_id" => "0b34988e-87b8-4b64-be0e-fe088caa9dff-qbksup",
                    "simple_bm_user_agent" => "Mozilla/5.0 (Series40; Nokia501/10.0.2; Profile/MIDP-2.1 Configuration/CLDC-1.1) Gecko/20100401 S40OviBrowser/3.0.0.0.73",
                    "derived_bm_browser_name" => "Nokia Xpress",
                    "derived_bm_browser_version" => "3.0.0",
                    "derived_bm_device_type" => "mobile",
                    "derived_bm_device_manufacturer" => "Nokia",
                    "simple_bm_created_at" => "2020-06-07 21:54:27"
                ]
            ],
            $extracted
        );
    }

}
